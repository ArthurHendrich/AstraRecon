import subprocess
import sys
import sqlite3

DATABASE = 'results.db'

def run_naabu(target):
    ports = "1883,8889,443,80,3000,6090,9060,8060,21,111,14430,24430,34430,44430,54430,64430,74430,84430,94430,104430,4430,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,1443,2443,3443,4443,5443,6443,7443,8443,9443,10443,11443,12443,13443,14443,15443,16443,17443,18443,19443,20443,21443,22443,23443,24443,25443,26443,27443,28443,29443,30443,31443,32443,33443,34443,35443,36443,37443,38443,39443,40443,41443,42443,43443,44443,45443,46443,47443,48443,49443,50443,51443,52443,53443,54443,55443,56443,57443,58443,59443,60443,61443,62443,63443,64443,65443,66443,67443,68443,69443,70443,71443,72443,73443,74443,75443,76443,77443,78443,79443,80443,81443,82443,83443,84443,85443,86443,87443,88443,89443,90443,91443,92443,93443,94443,95443,96443,97443,98443,99443,100443"
    result = subprocess.run(["naabu", "-silent", "-p", ports, target], capture_output=True, text=True)
    if result.stdout:
        with sqlite3.connect(DATABASE) as conn:
            c = conn.cursor()
            c.execute('INSERT INTO naabu_results (target, result) VALUES (?, ?)', (target, result.stdout))
            conn.commit()

if __name__ == "__main__":
    target = sys.argv[1]
    run_naabu(target)
